\documentclass[a4paper]{article}

\usepackage[english]{babel}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{graphicx}
%\usepackage[colorinlistoftodos]{todonotes}
\usepackage[parfill]{parskip}
\usepackage{multirow}

\usepackage{hyperref}

%\usepackage{geometry} % to change the page dimensions
%\geometry{a4paper} % or letterpaper (US) or a5paper or....
\usepackage{booktabs} % for much better looking tables
\usepackage{paralist} % very flexible & customisable lists (eg. enumerate/itemize, etc.)
\usepackage{verbatim} % adds environment for commenting out blocks of text & for better verbatim
\usepackage{subfig} % make it possible to include more than one captioned figure/table in a single float

%%% HEADERS & FOOTERS
\usepackage{fancyhdr} % This should be set AFTER setting up the page geometry
\pagestyle{fancy} % options: empty , plain , fancy
\renewcommand{\headrulewidth}{0pt} % customise the layout...
\lhead{}\chead{}\rhead{}
\lfoot{}\cfoot{\thepage}\rfoot{}

%%% SECTION TITLE APPEARANCE
\usepackage{sectsty}
\allsectionsfont{\sffamily\mdseries\upshape} % (See the fntguide.pdf for font help)
% (This matches ConTeXt defaults)

\usepackage{listings}
\usepackage{color}

\definecolor{mygreen}{rgb}{0,0.6,0}
\definecolor{mygray}{rgb}{0.5,0.5,0.5}
\definecolor{mymauve}{rgb}{0.58,0,0.82}

\lstset{ %
  backgroundcolor=\color{white},   % choose the background color; you must add \usepackage{color} or \usepackage{xcolor}
  basicstyle=\footnotesize,        % the size of the fonts that are used for the code
  breakatwhitespace=false,         % sets if automatic breaks should only happen at whitespace
  breaklines=true,                 % sets automatic line breaking
  captionpos=b,                    % sets the caption-position to bottom
  commentstyle=\color{mygreen},    % comment style
  deletekeywords={...},            % if you want to delete keywords from the given language
  escapeinside={\%*}{*)},          % if you want to add LaTeX within your code
  extendedchars=true,              % lets you use non-ASCII characters; for 8-bits encodings only, does not work with UTF-8
  frame=single,                    % adds a frame around the code
  keepspaces=true,                 % keeps spaces in text, useful for keeping indentation of code (possibly needs columns=flexible)
  keywordstyle=\color{blue},       % keyword style
  language=Octave,                 % the language of the code
  morekeywords={*,...},            % if you want to add more keywords to the set
  numbers=left,                    % where to put the line-numbers; possible values are (none, left, right)
  numbersep=5pt,                   % how far the line-numbers are from the code
  numberstyle=\tiny\color{mygray}, % the style that is used for the line-numbers
  rulecolor=\color{black},         % if not set, the frame-color may be changed on line-breaks within not-black text (e.g. comments (green here))
  showspaces=false,                % show spaces everywhere adding particular underscores; it overrides 'showstringspaces'
  showstringspaces=false,          % underline spaces within strings only
  showtabs=false,                  % show tabs within strings adding particular underscores
  stepnumber=2,                    % the step between two line-numbers. If it's 1, each line will be numbered
  stringstyle=\color{mymauve},     % string literal style
  tabsize=2,                       % sets default tabsize to 2 spaces
  title=\lstname                   % show the filename of files included with \lstinputlisting; also try caption instead of title
}


\usepackage[nottoc,notlof,notlot]{tocbibind} % Put the bibliography in the ToC
\usepackage[titles,subfigure]{tocloft} % Alter the style of the Table of Contents
\renewcommand{\cftsecfont}{\rmfamily\mdseries\upshape}
\renewcommand{\cftsecpagefont}{\rmfamily\mdseries\upshape} % No bold!


\title{SSAS-E2013 Programming Assignment - Part II}
\author{Team 6:\\Christian Lyngbye, Jacob Fischer, Rasmus Greve, Ivaylo Sharkov}

\begin{document}
\maketitle

\tableofcontents

\newpage
\section{Introduction}
This is the written hand-in for the second part of the programming assignment of the course. With regards to the report, we have addressed the issues presented in the feedback from the first part of the assignment. Secondly, we have incorporated the customer's requests for this assignment in our analysis and design process in order to integrate it with our existing system as seamlessly as possible.

%The report is structured... etc. TODO
We start by describing our strategy for the architecture. We try to cover the 7 touchpoints except the code review because we had trouble finding tools. 

\section{Strategy}
By defining our strategy clearly and sharing it with our users, we hope to align our strategy with our business and technology.

We start by listing our goals and afterwards we will define how and why we expect to reach them.

\begin{itemize}
\item
We hope to engage our users in a new social platform based on their interests.
\item
The brand should build trust with the users over the long term so they keep coming back.
\end{itemize}

% how
We wish to achieve our goals by providing the following features to our users:
\begin{itemize}
\item Easy signup with design that provides high quality features with as few clicks as possible.
\item Users can choose from a long list of social hobbies and find others with the same interests.
%\item Full data ownership: All data is owned by the users and should be easy to export and reuse.
\end{itemize}

\subsection{Risk Analysis and Management}
The business context is an application developed by a small enterprise with public customers with no contract of any sort. We provide a rudimentary service level agreement though there is no consequences if it is compromised. Most of the analysis is based on experience from using similar applications or our projections of how prospective interviewees would answer our questions.
\subsubsection{Business Goals}
We have decided on the following goals as paramount to our business operation with the web application. If any of these are not met, we consider it a severe threat to the integrity of our business.

\begin{table}[h!]
	\begin{tabular}{|p{10cm}|l|}
		\hline
		\textbf{Business Goal} & \textbf{Rank} \\ \hline
		The server must provide 99.5\% uptime   & \textbf{M} \\ \hline
		Sensitive user data is never compromised & \textbf{H} \\ \hline
		The application should be improved gradually by releasing new versions often & \textbf{L} \\ \hline
		Application must be live by October 4th 2013 &	\textbf{H}\\ \hline
		The application should be usable by a novice computer user on small screens (smartphones) as well as desktops & \textbf{M}\\ \hline
	\end{tabular}
	\caption{Business goals for our project. The goals are ranked with letters where L: low, M: medium and H: high}
	\label{tab:business_goals}
\end{table}



\subsubsection{Business Risks}
We have analyzed the business risks of the project and determined their impact which we have imagined as they would be for a small size enterprise.
\begin{table}[h!]
\begin{tabular}{| p{4cm} | p{3cm} | l | p{3cm} |}
\hline
\textbf{Business Risk} & \textbf{Indicators} & \textbf{Likelihood} & \textbf{Impact} \\ \hline
Data loss & Reports of service outage & L & Loss of potential users\\\hline
A user is subject to social engineering & Reports of peculiar activity & H & Damage to brand \\\hline
Vulnerabilities in the system & High amount of breaches & H & Unintended downtime and higher development costs \\\hline
Application delayed & System features are implemented late & M & Late return on investment \\\hline
\end{tabular}
\end{table}


\subsubsection{Technical Risks}
The technical risks are characterized by their probability and effect on the system in table \ref{tab:risk_analysis}. We have also identified risks in making the system too secure.

\begin{table}[h!]
	\begin{tabular}{| l | p{3cm} | l | l |}
		\hline
		\textbf{Risk} & \textbf{Indicator} & \textbf{L} & \textbf{C}  \\ \hline
        %User login bruteforcing & Repeated login attempts in logs & M & 6 \\ \hline
        %TR5 & SQL injections & 80\% & 9 & Prepared statements and input sanitization \\ \hline
        %User session hijacking & Reports from users of peculiar behavior & M & 4 \\ \hline
        Old libraries and platforms provide an easy target & Unsupported software & H & 9 \\\hline
        Hardware failure & Reports of downtime & L & 5 \\ \hline
        Security is not part of system architecture design & Unsecure design & M & 7 \\ \hline
		Security safeguards slows down user experience & Too many interactions & L & 3
		\\ \hline
	\end{tabular}
	\caption{Risk analysis for the social network system with mitigation strategies. L: Likelihood that it will occur. C: Consequences on a scale from 1 to 10}
	\label{tab:risk_analysis}
\end{table}



In table \ref{tab:goal_to_risk_relationship} the business and technical risks are synthesized. The technical risks are from table \ref{tab:risk_analysis}.

\begin{table}[h!]
	\begin{tabular}{| p{4cm} | p{4cm}| p{4cm} |}
    \hline
   	\textbf{Business goals} & \textbf{Business Risk} & \textbf{Technical risk} \\ \hline
   Sensitive user data is never compromised & Vulnerability in the system & Old libraries and platforms provide an easy target \\ \hline
    The server must provide 99.5\% uptime & Data loss &  Hardware failure \\ \hline
    %\multirow{4}{4cm}{The web server is breached at most twice throughout the project period} & \multirow{4}{4cm}{Vulnerabilities in the system} & TR5 & SQL injection \\ & & TR8 & Replay attack \\ & & TR9 & Cross-site request forgery \\ & & TR12 & Cross-site scripting (XSS) \\ \hline    
    Application must be live by October 4th 2013 & Application delayed &  Security is not part of system architecture design \\ \hline
    The application should be usable by a novice computer user on small screens (smartphones) as well as desktops & A user is subject to social engineering & Security safeguards slows down user experience \\ \hline
    \end{tabular}
    \caption{Goal-to-risk relationship table.}
	\label{tab:goal_to_risk_relationship}
\end{table}



\subsubsection{Mitigations}
We have ranked the risks and provide our proposals for mitigation.
\textbf{Vulnerability in the system}
Use supported third party libraries to keep all parts of the software secure to avoid the compromise of sensitive user data by Securing the Weakest Link.


By assigning clients user credentials we can identify them and separate them into different roles that we might need and do \textbf{Separation of Privilege}.

\textbf{Data loss}
We do backups of the database and encrypt it.

\textbf{Application delayed}
Having a planned milestone gives an idea of what it is possible to do.
Decreasing the scope to something manageable helps as well.

\textbf{A user is subject to social engineering}
Providing warnings to users.

% why
%\begin{itemize}
%\item Reluctance to Trust
%\item Securing the Weakest Link
%\item Failing Securely
%\item Least Privilege
%\item Separation of Privilege
%By assigning clients user credentials we can identify them and separate them into different roles that we might need.
%\item Promoting Privacy
%\end{itemize}
%Confidentiality, Integrity, Availability

\section{System Specification}
In accordance with the project description, we have defined our system as a web application where students can form friendly or romantic relationships with other students. The application should furthermore support administrative users, who are able to modify certain aspects of the system from a client's perspective. These requirements derive from the user stories presented in the project description. Throughout the project period, there has been three such sets of requests from the "customer".

We have considered each of these user stories and made corresponding use cases for the system, leading to functional requirements. Some of the user stories have related instead to non-functional requirements, and some again to security requirements.

In addition, we have specified a number of abuse cases, constituting a security-related counterpart to the use cases. Based on these, we have derived additional functional, non-functional and security requirements. Not all abuse cases have had equal impact on the final specification, as we have had to keep in mind the strategic prioritizations outlined in the Risk Management section.

\subsection{Use cases}
\begin{itemize}
\item A user signs up as a student
\item A student views/edits his own information
\item A student requests a friendship with another student
\item A student approves a friendship request with another student
\item A student upgrades a friendship to a romance
\item A student views a studentâ€™s information when they are in a relationship
\item A student sends a "hug" to a student that they are in a relationship with
\item An administrator deletes an existing user
\item An administrator views the information of a user
\item A competing service imports public data from our application
\item Our application imports public data from a competing service
\end{itemize}

\subsection{Abuse cases}
\begin{itemize}
\item A malicious user runs arbitrary queries on the database by submitting SQL code through an input field
\item A malicious user injects a script into HTML content that is presented to other users
\item A malicious user fills the system with irrelevant data by automatically creating multiple user profiles with a self-repeating script
\item A malicious user with two profiles logs into two different sessions and attempts to induce a race condition in the system by having both profiles befriend each other simultaneously
\item An unauthorized third party is picking up a user's traffic by listening on the same network the user is connected from
	\begin{itemize}
		\item The third party gains access to sensitive user data against the regulations of the privacy policy
		\item The third party gains access to the user's session ID, allowing the intruder to impersonate the user when communicating with the application
	\end{itemize}
\item A person with access to an administrator's credentials wreaks havoc on the system by deleting multiple user profiles
\item A competing web service exposes malicious data, such as client-side executable code, when exporting to our application
\end{itemize}

\subsection{Functional Requirements}
Most of the following functional requirements are derived from the use cases, to support the functionality that the customer has requested in the project description. A few requirements have been added and/or modified based on the abuse cases, however, and these are marked with a star (*) and mentioned here.

* In order to prevent an intruder who has hijacked a user's session ID from tampering with the user profile itself, we require users to re-enter their password whenever they submit changes to their profile data.

** In order to prevent people with access to an administrator's credentials from destroying user data in the system, an administrator is only able to suspend (and not delete, as per the use case) user profiles. Other administrators will then be able to restore the profile, in the case of a mistake. We feel that this is a good compromise, which does not stray too far from the original use case.
\begin{itemize}
\item A database model supporting users with the following data represented:
  \begin{itemize}
  \item User
      \begin{itemize}
      \item Username (this is necessary as the customer wants both proper name and email to be private information)
      \item Password
      \item Email
      \item First name
      \item Last name
      \end{itemize}
  \item Hobbies
  \item Friends/romances
  \end{itemize}
\item CRUD for users
	\begin{itemize}
    \item Users should be able to view their own data
    \item Users should be able to view other users' data, filtered depending on their relationship with the given user
    \item Users should be able to edit their own data upon re-entry of their password *
    \item Admins should be able to suspend and restore user profiles **
    \end{itemize}
\item User authentication
	\begin{itemize}
	\item Captcha authentication on the user creation form
	\end{itemize}
\item Admin authorization
\item Browse functionality for finding other users
\item Exposition of public data through a REST API
\item Support for importing public data from an external REST service into our own application
\end{itemize}

\subsection{Non-functional requirements}
The following is our non-functional requirements to the system. These are derived from our business goals, one of which relates to uptime. Another of our business goals is to employ immediate mitigation against any attack we might be subject to throughout the project period.
\begin{itemize}
\item The application is available through an HTTP connection 99.5\% of the time
\item A logging framework is enabled that allows the team to identify the underlying causes of any breaches that may occur
\end{itemize}


\section{Architecture}

Our production server runs Linux and provides the access control for users' access to the file system.

\subsection{Operations}
We have some assets that we think are worth protecting e.g. our database so we apply our principles\cite{princ} to the operations.

\begin{description}
\item[Least Privilege] 

We have disabled remote login for the root user. Users are only given the necessary privileges to the file system so we protect log files from malicious users.
The application server and database runs each with their respective user that is only used for that process. However we needed to host the application on port 80 so we configured it using another tool called authbind.
% TODO find tool give root access to the application server because it needs to run on port 80.

The database user/role for the database creation is different from the user that is used by the application server. 
%By applying this practice we give the application the least possible privilege to the database to protect our database from being dropped.

We have created users for each member of the teamn in a group with superuser rights. Furthermore there are users created for the web application and database.
This ensures that we can withdraw rights if necessary without losing access to the system.
This way we have restricted access to the database by only allowing the database user itself to connect as a client without password.

\item[Reluctance to Trust]
We only store the unique password to the database for the application user on the server. We don't trust the confidentiality of our Version Control System.

\item[Fail Securely]
There is no need to expose information about the software we use so we filter out 404/500 error codes in our application to show our custom error page.
\end{description}

\subsubsection{Frameworks and Technologies}
The following is a list of all the frameworks and technologies we have decided to use, with a short justification for each. In general we use open source technologies that promote awareness about security issues.
\begin{description}
\item[JSF2] This is the recommended dynamic web page technology for this course, which makes help more readily available. In addition, we are all fairly experienced with Java, and one person on the team has prior experience with JSF. It provides protection against XSS and CSRF. 
\item[Apache Tomcat 7.0.26] This is a lightweight application server for Java web applications that supports Servlet 3.0 and HTTP 1.1. It is the recommended server technology. 
\item[UFW] The Uncomplicated Firewall, is a straightforward firewall implementation for Linux that provides easy configuration of port filtering/blocking etc.
\item[Hibernate 3] is a library that provides ORM and can encapsulate database access in transactions and maps objects to relations.
\item[PostgreSQL 9.1.9] is a RDBMS that provides extensive functionality like auto generated id sequences and fine-grained access control of database operations for users. The devlopers provide a list of security issues \footnote{\href{http://www.postgresql.org/support/security/}{http://www.postgresql.org/support/security/}} and we have considered that the version we chose is safe.
\item[JUnit and Selenium with Selenide] for testing our application. JUnit provides a unit-testing framework for Java, which Selenium integrates with. Selenide is a framework for running tests for a web application through the browser.
\item[Commons Logging]
Tomcat supports commons logging and we use this to create an audit log for tracking intrusions.
\item[Uptime Robot] This is a uncomplicated and free SaaS that monitors websites for downtime and sends email if they are unresponsive.
\item[Snort] Snort is an Intrusion Detection System that logs intrusions using tcpdump.
\end{description}


\textbf{SHA-256} algorithm for hashing our users' passwords. It is generally regarded as a considerably secure hashing algorithm.
We use a randomly generated 4 character salt for every user.


\subsection{Architecture Risk Analysis}
The authentication module in the forest view shown in \ref{fig:forest_view} is a JSF Phase listener that the JSF servlet invokes. It has one role that it checks.
Furthermore there is a filter that protects against accessing the web pages outside the JSF servlet.



\begin{figure}[h!]
\centering
\includegraphics[scale=0.3]{ForestView}
\caption{Forest View diagram}
\label{fig:forest_view}
\end{figure}

\subsubsection{Attack Resistance Analysis}
We found the following historic attacks on applications.

\begin{table}[h!]
	\begin{tabular}{| l | p{4cm} | l | l | p{5cm} |}
		\hline
		\textbf{ID} & \textbf{Threat} & \textbf{P} & \textbf{C} & \textbf{Possible mitigation} \\ \hline
		TR1 & User gives away password & 2\% & 6 & Educate users. Restrict user privileges. \\ \hline
        TR2 & Admin gives away password & 0.1\%  & 10 & High requirements for admin hiring \\ \hline
        TR3 & Admin login bruteforcing & 50\% & 10 & Password requirements and login throttling \\ \hline
        TR4 & User login bruteforcing & 30\% & 6 & Password requirements and login throttling \\ \hline
        TR5 & SQL injections & 80\% & 9 & Prepared statements and input sanitization \\ \hline
        TR6 & Admin session hijacking & 10\% & 8 & Encrypted connections \\ \hline
        TR7 & User session hijacking & 1\% & 4 & Encrypted connections \\ \hline
        TR8 & Replay attacks & 1\% & 3 & Use nonces \\ \hline
       	TR9 & Cross-site request forgery & 1\% & 8 & Use nonces \\ \hline
        TR10 & Hardware failure & 5\% & 8 & Multiple servers and data backups \\ \hline
        TR11 & Server loses internet connection & 0.1\% & 5 & Multiple servers and/or connections \\ \hline
        TR12 & Cross site scripting (XSS) & 5\% & 8 & Input sanitazion and validation \\ \hline
	\end{tabular}
	\caption{Threat analysis for the social network system with mitigation strategies. P: Probability in percent. C: Consequences on a scale from 1 to 10}
		\label{tab:threats}
\end{table}


The application protects against the following:
\begin{description}
\item[SQL injections] By encapsulating database queries in 
\item[XSS attacks] JSF2 provides protection against this.
\item[Race conditions] We can avoid deadlock by using transaction in Hibernate.
%\item{Login bruteforcing}
%\item{Admin subject to social engineering}
\end{description}


We have chosen this prioritization of threats by looking at the probability and consequenses of each of them as well as estimating how complicated it is to implement the mitigation strategy.

SQL injections and XSS attacks are relatively easy to protect against in our setup as the tools we use, prevent these kinds of attacks. Hibernate, which we use for ORM, renders any SQL injection attempt useless by supporting prepared statements and parameterization. JSF protects against XSS attacks.
%TODO: Does JSF protect against XSS attacks?

We have also taken measures to protect against race conditions, one of the sins covered in \cite{sins2009}. This is for the most part a question of making sure to write re-entrant code in critical sections where race conditions could be a threat to the integrity of our data. It is also inherently supported at the database layer by transactions in Hibernate.
% \ref{sec:appendix:racecondition} This "test" is really bad...


We do not claim to protect against XSRF attacks so we did not mitigate this result it.


\subsubsection{Ambiguity Analysis}

We didn't validate user input so all text was saved. This was a problem because even though the input was escaped it obstructed database commands due to special characters interfering.

\subsubsection{Weakness Analysis}
There is a weakness in the architecture between the client browser and the server where a 'man-in-the-middle' can intercept requests and produce any response he likes.


We did a penetration test of our own application where we tested for the following threats.

\begin{verbatim}
xsrf, htaccessMethods, sqli, sslCertificate, fileUpload, mxInjection, generic, localFileInclude, unSSL, xpath, osCommanding, remoteFileInclude, dav, ssi, eval, buffOverflow, xss, xst, blindSqli, formatString, preg\_replace, globalRedirect, LDAPi, phishingVector, frontpage, responseSplitting
\end{verbatim}
     
We found vulnerabilities in the public web pages:
\begin{verbatim}
 The following scripts are vulnerable to a trivial form of XSRF:
 - http://team6.bollgreve.dk/ssase13/f/profile.xhtml
 The following scripts allow an attacker to send POST data as query 
 string data (this makes XSRF easier to exploit):
 - The URL: http://team6.bollgreve.dk/ssase13/f/signup.xhtml is 
vulnerable to cross-site request forgery. It allows the attacker to 
exchange the method from POST to GET when sendin data to the server.
\end{verbatim}
This is due to the JSF libraries that only partially protect against Cross(X) Site Request Forgery. This is a weakness in the platform we have chosen.
\begin{verbatim}
 The URL: http://team6.bollgreve.dk/ssase13/f/profile.xhtml is 
vulnerable to cross-site request forgery.
 An unidentified vulnerability was found at: 
 "http://team6.bollgreve.dk/ssase13/f/profile.xhtml", using HTTP method GET. 
 The sent data was: "id=d%27kc%22z%27gj%27%22%2A%2A5%2A%28%28%28%3B-%2A%60%29". 
 This vulnerability was found in the requests with ids 1016 to 1017 and 1019.
\end{verbatim}

We are not sure what the unidentified vulnerability mentioned is but this is one of the requests:
\begin{verbatim}
========================================Request 1017 - 
Sat 14 Dec 2013 01:09:11 AM CET========================================
GET http://team6.bollgreve.dk/ssase13/f/profile.xhtml?id=27854292 HTTP/1.1
Accept-Encoding: gzip
Accept: */*
User-Agent: w3af.sourceforge.net
Host: team6.bollgreve.dk
Cookie: JSESSIONID=CC4B00E98F4083C6CB66E1B5A4974676
Referer: http://team6.bollgreve.dk/
\end{verbatim}

\subsubsection{Safeguards}
In order to create a trust zone the application authorizes users in order based on their role (of which there are only 2). Then we can control access to pages based on a black list of which pages are public so we always protect new pages.

The following pages are unprotected:
\begin{description}
\item[login.xhtml] - default landing page
\item[signup.xhtml] - sign up page
\item[userList.xhtml] - list of all users
\item[profile.xhtml] - a users profile
\item[alienprofile.xhtml] - an externally imported profile
\end{description}
  
  

\begin{lstlisting}  
public void afterPhase(PhaseEvent event) {
  FacesContext context = event.getFacesContext();  
  boolean authorized = false;
  if (userExists(context)) {
    // allow processing of the requested view
    if (requestingAdminView(context)) {
      if(userAdmin(context)) {
        authorized = true; 
      }                     
    } else 
      authorized = true;
  } else {            
    // send the user to the login view
    if (requestingSecureView(context)) {                
      redirectToLogin(context);
    } else {
      authorized=true;
    }
  }
}
        
\end{lstlisting}

\subsection{Security Requirements}
Based on the prioritizations of the Risk Management section, as well as the previously listed abuse cases, we have derived the following security requirements to our application.

We do not require the application to run through a secure connection, as although it would provide good protection against abusive users sniffing packages on an open network, we have decided not to pursue this for a variety of reasons. If we were to self-sign a certificate for SSL, it would mean a considerable reduction in usability, as most browsers warn users against entering sites signed with untrustworthy certificates. It is also not a completely trivial task to set up a certificate, and it is further complicated by the absence of a domain name to register it with. Securing traffic with SSL also makes it harder for clients to communicate with our application through the REST API. So instead of self-signing a certificate, we have, as previously mentioned, modified our functional requirements to mitigate this particular abuse through alternative means.
\begin{itemize}
\item A firewall blocks requests on all ports but port 80 (HTTP) and port 6666 (SSH)
\item Database access credentials are never stored in any source code repository
\item The database is always accessed in a manner that protects against SQL injection
\item The application guards against cross-site scripting
\item Logfiles on the web server are only accessible with root permissions
\item All input from users and other web services is validated and/or sanitized
\end{itemize}

\subsubsection{Project Tools}
We have chosen to use the following tools to assist us in our project process.
\begin{itemize}
\item \textbf{Git} is our chosen tool for source control, since it is easy to use and gets the job done, and Github is a decent platform for hosting source code on.
\item \textbf{Google Docs} is what we use for taking notes and making on-the-fly documents, spreadsheets or presentations that we might need throughout the project. It is very easy to share things here, but the text processing tool is not that powerful, so it is not where we write our report.
\end{itemize}


\section{Testing}

\subsection{Test plan}
\subsubsection{Testing objectives}
\subsubsection{Features to be tested}
\begin{itemize}

\item Signup
\item Login
\item Friends relation features
\item Hobbies

\end{itemize}
\subsubsection{Testing techniques}
\begin{itemize}

\item Unit tests
\item Blackbox (TBS)
\item SELENIUM (selenide)
\end{itemize}

\subsubsection{Static Testing}
Static testing is testing of a component or specifications without execution of that software.  This is usually done as soon as acceptance criteria or business requirements are ready for review before code implementation such as conflicting rules, invalid data types, redundant process just to name a few. 
\subsubsection{Component Testing}
Component level testing focuses on the functionality of each component being developed.  This is  crucial where different components are being developed before they are integrated together as one system.

Entry Criteria

Component Testing may commence when the following criteria has been satisfied:
All code has been unit tested and passed.
Test environment including software has been setup and configured correctly.
Business requirements and test cases are up to date as per user story.

Suspension Criteria

Component testing will be suspended under the following condition:
Critical error(s) found preventing test completion.
Change of business requirements.
Change of environment components or technology including different version.

Resumption Criteria

Component testing will resume when the following criteria are met:
All issues in suspension criteria have been resolved or mitigated.
New software build has been redeployed.

Exit Criteria (Test Completeness)

Component testing can be considered complete when the following conditions have been met:
All requirements have been tested without Critical or Medium severity defects.
 System Testing
The purpose of the system testing is to validate that the complete and integrated system complies with functional requirements and business requirements.

Entry Criteria

System testing may commence when the following criteria have been satisfied:
Component Testing has been completed.
No change to business requirements and test cases are up to date.
Scenario based test cases have been reviewed.

Suspension Criteria

System Testing will be suspended under the following condition:
Critical error(s) found affecting functionality of the whole system.
Change of business requirements.

Resumption Criteria

System Testing will resume when the following criteria have been satisfied:
All issues in suspension criteria have been resolved or mitigated

Exit Criteria (Test Completeness)

System Testing will be considered complete when the following conditions have been met:
All High and Medium priority requirements have been tested without Critical or Medium severity defects.

Business owner and/or business user have been notified with any remaining defects and understand the risks or limitations of current release.

User Acceptance Testing 

UAT is a formal testing with respect to user needs, business requirements and expectations.  The idea here is to gain confidence from business owner on the software being developed.  Although it is not mandatory business owner(s) and/or business user(s) are expected to produce his/her own test scenarios.
\subsection{Tools and Frameworks}
Testing is essential in order to build secure and functional software systems. To thoroughly test our system we have decided to use two testing strategies; system tests and unit tests.

A testing tool we found fitting to use for system tests is Selenium with JUnit. Selenium allows us to script test cases which input data and submit forms on the webservice.

\subsection{System Test Cases (Black-box Test)}

\begin{itemize}
\item Login
\item SQL injection in input
\item Access to unauthorized pages
\item Creating user
\item Renewing password
\end{itemize}

\section{Hacking}
\subsection{Plans and ideas}
In this section we describe plans and ideas for hacks and attacks that we haven't (yet) conducted.
\subsubsection{Social engineering attack}
A social engineering attack requires some knowledge and analysis of the setting, system and people you want to attack.

The setting at hand is that we are among a set of teams all implementing and trying to secure a webservice which must be "handed in" and shown off to a teacher and possibly the TA. This implies that the people in the teams all trust both the teacher and the TA. We have observed that most of us do not remember the name of the TA off the top of our heads and need to look it up on the course blog.
We can use this knowledge to make a broad social engineering attack on all other groups attempting to obtain confidential information such as usernames and passwords for admin accounts.

The idea is to send an email to the entire class that looks and sounds official and says that it is from ``The TA of System Architecture and Security F2013". We assume that the students are not aware of the name of our TA and that they will trust that if we claim to be him in the email, they will believe us. The email will contain a request for login information to their webservice for an admin account that we need in order to evaluate the teams' progress.

A requirement for this attack to work is that we send the email before (if) the teacher or TA asks for this information from the groups. We plan on sending the email on the 4th of October.


\textbf{Team 1}

\subsection{Penetration test of team 11}
As part of the project we have conducted a penetration test on another groups web service.
Pennetration testing is the process of conducting a test of a system that is partially or fully implemented and running preferably in the production invironment, in order to get as realistic a test setting as possible.

The goal of the test is to uncover security problems in the application by actually trying to attack the running application using any number of techniques. This exercise is commonly executed by security experts that have a lot of knowledge about the general concepts of hacking and attacking, and who understand the proper way to exploit weaknesses. 
A good way to perform the test is by first looking at the technologies and frameworks that the application use and in particular which version. With this information it is possible to look in open exploit- and bug databases to search for entries that might impact the security of the application, and then try to execute attacks based on the bugs.

\textbf{Automated testing}
Tools have been created to aide the security expert in her analysis or to help novice security testers. Basically two kinds of tools exist; static analysis tools and dynamic testing tools.
The static tools work by inspecting either the source code of the application if this is available, or binaries/decompiled binaries, trying to find common implementation errors in the application that can be exploitet by malicious users or simply triggered by unknowing normal users.
The dynamic tools work by inputting lots of different data in all data-entry points in the application. Usually edge-case data is used such as 0, 1 and 2,147,483,647 for numbers and empty or very long strings maybe containing special characters or for string inputs.

Our attempt at a penetration test consist of us using a dynamic pen-test tool called w3af on the application of team 11.
We cannot use a static analysis tool since we do not have access to neither source code nor binary code as everything is well hidden on the webserver. To perform the best possible penetration test we have attempted to get the source code from their server, but they seem to have configures their firewall well and closed any holes that we have been able to think of. Given other circumstances a dictionary password breaking attack could have been performed in order to try to take over the server, but in this case all forms of DoS attacks are disallowed.

\textbf{The tool w3af}
w3af is in the words of the creators a "Web Application Attack and Audit Framework". It is open source and developed in python. It is built as a plugin framework where each known vulnerability to test, is contained as a plugin. This makes it easy to change what is tested and carefully conduct a specialized attack against a web application where you know which tools and frameworks run underneath.


\textbf{Attacking team 11}
The webapplication that team 11 has made, "Raptor dating", seems to be
%About team 11
%w3af on team 11

\subsection{XSS attack on team 10}
\subsubsection{Description}
As part of the requirement to expose the publicly available data in our system to one or more of our competitors through a REST API, we saw a natural opportunity to try and inject malicious data into \textbf{their} systems. The basic idea was to have a piece of code in our REST service class replace the string exposed by the service when requesting a particular hobby with a different, pre-defined string, containing malicious data. This data would just be a text string, containing the HTML tag for JavaScript, executing an alert in the client's browser. This is just to demonstrate the vulnerability, as the ability to execute JavaScript originating from us on the clients of our competitor could lead to many kinds of attacks, particularly XSS.

Doing a bit of research, we found out that team 10 in particular might be vulnerable to this kind of attack. During conversations with them about how best to exchange data through a REST API, we learned that they stored the interests (hobbies) of their users in comma-separated text strings. At this point we also applied a dose of social engineering by explaining to them in detail how they might consume our web service from their application, in an attempt to get them to implement their client as naively as possible.

\subsection{Brute force attempt on Mysql server on team 5}
After doing an nmap scan we found that the mysql server was listening.
We found a vulnerability for an older version of mysql http://thehackernews.com/2012/06/cve-2012-2122-serious-mysql.html
We tried brute forcing a connection to mysql but our IP was blacklisted after 10 attempts.

\subsubsection{Results}
See figure 4 under chapter 9.4 in the appendix for graphical illustration of the results of this attack. As denoted in the figure, the Fishing hobby was the one we configured to result in malicious code rather than its innocent name in a string, whenever requested by a web server located on team 10's IP address. As can be seen, the user with the hobby correctly imports to team 10's "Friendship Portal", but the malicious string produced by the Fishing hobby is not displayed, and is not even present in the document's source. This indicates that team 10 did anticipate this kind of attack, and took the appropriate security measures by validating the data imported from our service.

%Inserted the following as username and password in login form:
%\begin{verbatim}
%' OR 1 = 1;--
%\end{verbatim}
%This resulted in a 502 error followed by errorcode 500 responses on following %attempts at reaching the website.
%In order to submit the form the in-browser email verification had to be disabled %(achieved by editing the DOM such that type="email" became type="text")


\section{Discussion}


\subsection{Problems}


\section{Conclusion}

\newpage
\section{References}
\begin{thebibliography}{9}
\bibitem{McGraw2006} 
Gary McGraw,
Software Security: Building Security In,
2006,
Addison-Wesley Professional 

\bibitem{sins2009}
Howard, M., LeBlanc, D., Viega, J.
Deadly Sins of Software Security: Programming Flaws and How to Fix Them,
2009,
Mcgraw-hill

\bibitem{princ}
\href{https://buildsecurityin.us-cert.gov/articles/knowledge/principles/design-principles}{https://buildsecurityin.us-cert.gov/articles/knowledge/principles/design-principles}, December 1st 2013
\end{thebibliography}

\newpage
\section{Appendix}
\subsection{Design diagrams}
\begin{figure}[h!]
\centering
\includegraphics[scale=0.3]{Domain}
\caption{Domain diagram}
\label{fig:domain_diagram}
\end{figure}
\begin{figure}[h!]
\centering
\includegraphics[scale=0.4]{ER}
\caption{Entity relationship diagram of our data-model}
\label{fig:er_diagram}
\end{figure}

\newpage
\subsection{Log file}
\subsubsection{Application online November 1st \label{sec:appendix:online}}
\begin{verbatim}
Nov 1, 2013 9:40:45 AM dk.itu.ssase.hb.beans.LoginBean validateUser
INFO: Authenticated user admin
Nov 1, 2013 9:40:51 AM dk.itu.ssase.hb.listener.AuthPhaseListener afterPhase
INFO: Authorized user
Nov 1, 2013 9:40:51 AM dk.itu.ssase.hb.beans.StudentBean addHobby
INFO: Hobby id: 2
\end{verbatim}

\subsubsection{Race conditions \label{sec:appendix:racecondition}}
\begin{verbatim}
Nov 15, 2013 10:45:55 AM 
dk.itu.ssase.hb.controller.FriendController requestRelationship
INFO: Add relationship to student id: 624
Nov 15, 2013 10:45:55 AM 
dk.itu.ssase.hb.controller.FriendController requestRelationship
INFO: Created relationship request with id: 8

Nov 15, 2013 10:45:56 AM 
dk.itu.ssase.hb.controller.FriendController requestRelationship
INFO: Add relationship to student id: 622
Nov 15, 2013 10:45:56 AM 
dk.itu.ssase.hb.controller.FriendController requestRelationship
INFO: Created relationship request with id: 9

Nov 15, 2013 10:46:01 AM 
dk.itu.ssase.hb.controller.FriendController findUnapprovedRelationshipRequests
INFO: Found friend request from: rasmusgreve
Nov 15, 2013 10:46:01 AM 
dk.itu.ssase.hb.controller.FriendController findUnapprovedRelationshipRequests
INFO: Found friend request from: rasmusgreve

Nov 15, 2013 10:46:32 AM 
dk.itu.ssase.hb.controller.FriendController findUnapprovedRelationshipRequests
INFO: Found friend request from: rasmusgreve
Nov 15, 2013 10:46:32 AM 
dk.itu.ssase.hb.controller.FriendController findUnapprovedRelationshipRequests
INFO: Found friend request from: rasmusgreve

Nov 15, 2013 10:47:40 AM 
dk.itu.ssase.hb.controller.FriendController approveFriend
INFO: Approve relationship id: 9
\end{verbatim}

\subsection{Test reports}
\begin{table}[h!]
\begin{tabular}{| l | l | l | l | l | l | l |}
\hline
Class & Tests & Errors & Failures & Skipped & Success Rate & Time \\ \hline
LoginTest & 2 & 0 & 0 & 0 & 100 \% & 9,411 \\ \hline
\end{tabular}
\end{table}
\begin{table}[h!]
\begin{tabular}{| l | l |}
\hline
testLoginSQLInjection & 8,332 \\ \hline
testLoginXSS & 1,069 \\ \hline
\end{tabular}
\end{table}

\subsection{Hacking}
\begin{figure}[h!]
\centering
\includegraphics[scale=0.3]{Team10_XSS}
\caption{XSS attack on team 10}
\label{fig:xss_screencap}
\end{figure}

\include{courselog}

\end{document}
